services:
  # Caddy Orchestrator Lite
  orchestrator:
    build: .
    ports:
      - "3000:3000"
    environment:
      #- CADDY_ADMIN_URL=http://caddy:2019
      - DB_PATH=/app/data/routes.db
    volumes:
      - orchestrator-data:/app/data
    depends_on:
      - caddy
    restart: unless-stopped

  # Test Caddy instance
  caddy:
    image: caddy:2-alpine
    ports:
      - "80:80"
      - "443:443"
      - "2019:2019"
    volumes:
      - caddy-data:/data
      - caddy-config:/config
    command: caddy run --config /etc/caddy/Caddyfile --adapter caddyfile
    configs:
      - source: caddyfile
        target: /etc/caddy/Caddyfile
    restart: unless-stopped

configs:
  caddyfile:
    content: |
      {
        admin 0.0.0.0:2019
      }

volumes:
  orchestrator-data:
  caddy-data:
  caddy-config:
